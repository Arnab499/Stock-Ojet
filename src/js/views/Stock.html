<div class="oj-hybrid-padding">
  <div class="stocks-header">
    <h1>Stocks</h1>
    <div>
      <oj-toolbar aria-label="Stock actions">
        <!-- ADMIN ONLY BUTTONS -->
        <oj-button id="addStockBtn" on-oj-action="[[addStock]]" data-bind="visible: isAdmin">Add</oj-button>
        <oj-button id="delStockBtn" on-oj-action="[[delStock]]" data-bind="visible: isAdmin">Delete</oj-button>
        <oj-button id="listStockBtn" on-oj-action="[[listStock]]">List</oj-button>
        <oj-button id="updStockBtn" on-oj-action="[[updateStock]]" data-bind="visible: isAdmin">Update</oj-button>
        <oj-button on-oj-action="[[showTrendsChart]]">Trends</oj-button>
      </oj-toolbar>
    </div>
  </div>
  <!-- LIST TABLE (both) -->
  <table border="1"
    data-bind="visible: stocks().length > 0 && !showAddForm() && !showDeleteActions() && !showUpdateActions() && liststk()">
    <thead>
      <tr>
        <th>Stock ID</th>
        <th>Stock Name</th>
        <th>Stock Price</th>
        <th>Stock Volume</th>
        <th>Listing Price</th>
        <th>Listed Date</th>
        <th>Listed Exchange</th>
        <!-- Only customer sees "Buy" action -->
        <th data-bind="visible: isCustomer">Action</th>
      </tr>
    </thead>
    <tbody data-bind="foreach: stocks">
      <tr>
        <td data-bind="text: stockId"></td>
        <td data-bind="text: stockName"></td>
        <td data-bind="text: stockPrice"></td>
        <td data-bind="text: stockVolume"></td>
        <td data-bind="text: listingPrice"></td>
        <td data-bind="text: listedDate"></td>
        <td data-bind="text: listedExchange"></td>
        <td data-bind="visible: $parent.isCustomer">
          <button data-bind="click: function(){$parent.buyStock($data);}">Buy</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ADMIN: DELETE TABLE -->
  <table border="1" data-bind="visible: stocks().length > 0 && showDeleteActions() && !showAddForm() && isAdmin">
    <thead>
      <tr>
        <th>Stock ID</th>
        <th>Stock Name</th>
        <th>Stock Price</th>
        <th>Stock Volume</th>
        <th>Listing Price</th>
        <th>Listed Date</th>
        <th>Listed Exchange</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody data-bind="foreach: stocks">
      <tr>
        <td data-bind="text: stockId"></td>
        <td data-bind="text: stockName"></td>
        <td data-bind="text: stockPrice"></td>
        <td data-bind="text: stockVolume"></td>
        <td data-bind="text: listingPrice"></td>
        <td data-bind="text: listedDate"></td>
        <td data-bind="text: listedExchange"></td>
        <td>
          <button data-bind="click: $parent.deleteByRow">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- ADMIN: UPDATE TABLE -->
  <table border="1" data-bind="visible:stocks().length > 0 && showUpdateActions() && !showAddForm() && isAdmin">
    <thead>
      <tr>
        <th>Stock ID</th>
        <th>Stock Name</th>
        <th>Stock Price</th>
        <th>Stock Volume</th>
        <th>Listing Price</th>
        <th>Listed Date</th>
        <th>Listed Exchange</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody data-bind="foreach: stocks">
      <tr>
        <td data-bind="text: stockId"></td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.stockName" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: stockName"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.stockPrice" type="number" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: stockPrice"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.stockVolume" type="number" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: stockVolume"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.listingPrice" type="number" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: listingPrice"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.listedDate" type="date" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: listedDate"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <input data-bind="value: $parent.editTemp.listedExchange" />
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <span data-bind="text: listedExchange"></span>
          <!-- /ko -->
        </td>
        <td>
          <!-- ko if: $parent.editingStockId() === stockId -->
          <button data-bind="click: function(){$parent.confirmEditStock($data)}">Confirm</button>
          <button data-bind="click: $parent.cancelEditStock">Cancel</button>
          <!-- /ko -->
          <!-- ko ifnot: $parent.editingStockId() === stockId -->
          <button data-bind="click: function(){$parent.editStockRow($data)}">Update</button>
          <!-- /ko -->
        </td>
      </tr>
    </tbody>
  </table>
  <!-- ADMIN: ADD FORM -->
  <!-- ko if: showAddForm() && isAdmin -->
  <div class="add-stock-panel">
  <div class="add-stock-title">Add New Stock</div>
  <label>ID:</label>
  <input type="number" data-bind="value: addStockId" placeholder="Stock ID" />
  <label>Name:</label>
  <input type="text" data-bind="value: addStockName" placeholder="Stock Name" />
  <label>Price:</label>
  <input type="number" data-bind="value: addStockPrice" placeholder="Price" />
  <label>Volume:</label>
  <input type="number" data-bind="value: addStockVolume" placeholder="Volume" />
  <label>Listing Price:</label>
  <input type="number" data-bind="value: addListingPrice" placeholder="Listing Price" />
  <label>Listed Date:</label>
  <input type="date" data-bind="value: addListedDate" placeholder="Listed Date" />
  <label>Listed Exchange:</label>
  <input type="text" data-bind="value: addListedExchange" placeholder="Listed Exchange" />
  <div class="button-group">
    <button data-bind="click: confirmAddStock">Submit</button>
    <button data-bind="click: function(){showAddForm(false)}">Cancel</button>
  </div>
</div>
  <!-- /ko -->

  <!-- CUSTOMER: BUY FORM DIALOG -->
  <!-- ko if: showBuyForm -->
  <div class="oj-panel" style="margin:20px 0; padding:16px; background:#eef;">
    <h4>Buy Stock: <span data-bind="text: buyStockObj() && buyStockObj().stockName"></span></h4>
    <div style="display: flex; flex-direction: column; max-width: 260px;">
      <label>Stock ID:</label>
      <span data-bind="text: buyStockObj() && buyStockObj().stockId"></span>
      <label>Price:</label>
      <span data-bind="text: buyStockObj() && buyStockObj().stockPrice"></span>
      <label>Qty:</label>
      <input type="number" min="1" data-bind="value: buyQty" />
      <div style="margin-top: 10px;">
        <button data-bind="click: confirmBuy">Buy</button>
        <button data-bind="click: cancelBuy">Cancel</button>
      </div>
    </div>
  </div>
  <!-- /ko -->

  <!-- STOCKS PRICE COMPARISON CHART -->
  <div data-bind="visible: showTrends">
    <div style="margin-bottom:32px;">
      <oj-chart id="stocksBarChart"
                type="bar"
                orientation="vertical"
                series="[[chartSeries]]"
                groups="[[chartGroups]]"
                animation-on-display="auto"
                animation-on-data-change="auto"
                style="height:330px;">
        <template slot="seriesTemplate" data-oj-as="item">
          <oj-chart-series color="[[item.seriesIndex === 0 ? '#29b6f6' : '#66bb6a']]"></oj-chart-series>
        </template>
      </oj-chart>
    </div>
  </div>
</div>